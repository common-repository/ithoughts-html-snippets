/**
 * @file Simple AJAX Form
 * @description jQuery extension to make forms AJAX enabled. Mainly used in WordPress projects
 *
 * @author Gerkin, tcbarrett
 * @copyright 2016 
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPLv3
 * @package iThoughts-toolbox
 *
 */
!function(e){"use strict";var t=e.$;t.fn.extend({simpleAjaxForm:function(a){var r={validate:!1},n=t.extend(r,a);return this.each(function(){var a=t(this),r=t.extend({target:a.data("target"),callback:a.data("callback")},n);r.target&&t("#"+r.target).length&&t("#"+r.target).html("").hide(),a.find('button[name="actionB"]').click(function(){a.find('[name="action"]').val(this.getAttribute("value"))});var o,i=this.getAttribute("post_text")?this.getAttribute("post_text"):"Updating, please wait...";a.ajaxForm({beforeSubmit:function(a,n,s){return r.target&&t("#"+r.target).length&&t("#"+r.target).html("<p>"+i+"</p>").removeClass().addClass("clear updating").fadeTo(100,1),o=e.makeLoader(),!0},error:function(){o.remove(),t("#"+r.target).removeClass().addClass("clear notice notice-error").html("<p>Form submission failed.</p>")},success:function(e,n,i,s){if(o.remove(),"undefined"==typeof s&&(s=i),"undefined"==typeof s)return t("#"+r.target).removeClass().addClass("clear notice notice-error").html(c.text),void a.append('<div class="error"><p>Cannot handle response properly</p></div>');try{var c;if("String"==e.constructor.name)c=JSON.parse(e);else{if("Object"!=e.constructor.name)throw"Unhandled type "+typeof e;c=e}"0"!=c&&c?("undefined"!=typeof c.success&&null!=c.success&&"undefined"!=typeof c.data&&null!=c.data&&(c.data.valid=c.success,c=c.data),c.valid?(c.reload&&(window.location.href=window.location.href+"&json-res-txt="+window.encodeURI(c.text)),r.target&&t("#"+r.target).length&&t("#"+r.target).removeClass().addClass("clear notice notice-success").html(c.text),c.redirect&&(c.text?setTimeout(function(){window.location.href=c.redirect},2500):window.location.href=c.redirect)):r.target&&t("#"+r.target).length&&t("#"+r.target).removeClass().addClass("clear notice notice-error").html(c.text),"function"==typeof a[0].simple_ajax_callback&&a[0].simple_ajax_callback(c),"function"==typeof r.callback&&r.callback(c)):t("#"+r.target).removeClass().addClass("clear notice notice-warning").html("<p>Server did not respond anything</p>")}catch(l){t("#"+r.target).removeClass().addClass("clear notice notice-error").html("<p>Invalid server response</p>")}}})})}}),e.$d.ready(function(){t(".simpleajaxform").simpleAjaxForm()})}(Ithoughts.v4);